<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Loan Decision Assistant</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #05080a;
      --bg-elevated: #101417;
      --bg-elevated-soft: #11161a;
      --border-subtle: #262b30;
      --text-primary: #f5f7f9;
      --text-muted: #9ba3ad;
      --accent: #23c3c9;
      --accent-soft: rgba(35, 195, 201, 0.12);
      --danger: #ff6b6b;
      --radius-lg: 14px;
      --radius-pill: 999px;
      --shadow-soft: 0 18px 40px rgba(0, 0, 0, 0.6);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #101822 0, #05080a 48%, #020304 100%);
      color: var(--text-primary);
      -webkit-font-smoothing: antialiased;
    }

    .app-shell {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 8px 0 12px;
    }

    .app-frame {
      width: 100%;
      max-width: 480px;
      height: 100vh;
      max-height: 840px;
      background: rgba(3, 6, 10, 0.96);
      border-radius: 26px;
      box-shadow: var(--shadow-soft);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.03);
    }

    .top-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 14px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.04);
      background: linear-gradient(90deg, #05080a, #0b1117);
    }

    .top-bar-left {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .brand-mark {
      width: 26px;
      height: 26px;
      border-radius: 9px;
      background: radial-gradient(circle at 25% 0, #ffffff 0, #dde5ef 35%, #a0b3c7 100%);
      position: relative;
      overflow: hidden;
    }

    .brand-mark::after {
      content: "";
      position: absolute;
      inset: 5px;
      border-radius: 6px;
      border: 2px solid #0b3a8c;
    }

    .brand-text {
      display: flex;
      flex-direction: column;
      font-size: 11px;
      line-height: 1.3;
    }

    .brand-text span:first-child {
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
      font-size: 10px;
    }

    .brand-text span:last-child {
      font-weight: 600;
    }

    .chip-muted {
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(13, 21, 30, 0.9);
      color: var(--text-muted);
      font-size: 11px;
      border: 1px solid rgba(255, 255, 255, 0.04);
    }

    .chat-scroll {
      flex: 1;
      overflow-y: auto;
      padding: 10px 10px 16px;
      scrollbar-width: thin;
      scrollbar-color: rgba(255, 255, 255, 0.12) transparent;
    }

    .chat-scroll::-webkit-scrollbar {
      width: 6px;
    }

    .chat-scroll::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.14);
      border-radius: 999px;
    }

    .chat-stack {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .message-card {
      background: linear-gradient(135deg, #0d1216, #06090d);
      border-radius: 18px;
      border: 1px solid var(--border-subtle);
      padding: 10px 11px 11px;
      box-shadow: 0 12px 28px rgba(0, 0, 0, 0.55);
    }

    .message-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 6px;
    }

    .message-header-left {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      color: var(--text-muted);
    }

    .status-dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: var(--accent);
      box-shadow: 0 0 0 5px var(--accent-soft);
    }

    .notify-link {
      font-size: 11px;
      color: var(--text-muted);
      display: flex;
      align-items: center;
      gap: 4px;
      cursor: default;
      opacity: 0.7;
    }

    .notify-link::before {
      content: "⏰";
      font-size: 11px;
    }

    .message-body {
      font-size: 13px;
      color: var(--text-primary);
      line-height: 1.55;
    }

    .message-body p {
      margin: 0 0 6px;
    }

    .message-body p:last-child {
      margin-bottom: 0;
    }

    .option-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 8px;
    }

    .btn {
      border: none;
      border-radius: var(--radius-pill);
      padding: 8px 14px;
      font-size: 13px;
      cursor: pointer;
      transition: background 0.15s ease, transform 0.08s ease,
        box-shadow 0.15s ease, color 0.15s ease;
      font-weight: 500;
      white-space: nowrap;
    }

    .btn-primary {
      background: var(--accent);
      color: #021014;
      box-shadow: 0 8px 18px rgba(26, 180, 186, 0.45);
    }

    .btn-primary:hover {
      background: #20aeb4;
      transform: translateY(-0.5px);
    }

    .btn-secondary {
      background: rgba(16, 22, 28, 0.9);
      border: 1px solid var(--border-subtle);
      color: var(--text-primary);
    }

    .btn-secondary:hover {
      background: rgba(26, 32, 40, 0.98);
    }

    .btn-ghost {
      background: transparent;
      border: 1px solid var(--border-subtle);
      color: var(--text-muted);
      font-size: 12px;
      padding: 6px 11px;
    }

    .btn-ghost.active {
      background: rgba(255, 255, 255, 0.02);
      color: var(--accent);
      border-color: var(--accent-soft);
    }

    .input-group-card {
      margin-top: 8px;
      padding: 8px 9px;
      border-radius: 12px;
      background: radial-gradient(circle at top left, #151b22 0, #06090d 60%);
      border: 1px solid rgba(255, 255, 255, 0.04);
    }

    .input-group-title {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .field-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 6px;
    }

    @media (min-width: 420px) {
      .field-grid {
        grid-template-columns: 1fr 1fr;
      }
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 3px;
      font-size: 11px;
      color: var(--text-muted);
    }

    .field-label-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 6px;
    }

    .field-helper {
      font-size: 10px;
      color: var(--text-muted);
      opacity: 0.8;
    }

    .field-input-shell {
      display: flex;
      align-items: center;
      gap: 4px;
      padding: 6px 8px;
      border-radius: 9px;
      background: rgba(6, 10, 14, 0.95);
      border: 1px solid rgba(255, 255, 255, 0.08);
    }

    .field-input-shell--slider {
      padding-top: 4px;
      padding-bottom: 2px;
    }

    .field-prefix,
    .field-suffix {
      font-size: 11px;
      color: var(--text-muted);
      white-space: nowrap;
    }

    .field-input {
      flex: 1;
      border: none;
      outline: none;
      background: transparent;
      color: var(--text-primary);
      font: inherit;
      font-size: 13px;
      min-width: 0;
    }

    .field-input::placeholder {
      color: rgba(155, 163, 173, 0.7);
    }

    input[type="range"] {
      width: 100%;
      accent-color: var(--accent);
    }

    .field-inline-value {
      font-size: 11px;
      color: var(--text-muted);
    }

    .card-footer-row {
      display: flex;
      justify-content: flex-end;
      margin-top: 9px;
    }

    .explanation-block {
      margin-top: 8px;
      padding: 8px 9px;
      border-radius: 10px;
      background: rgba(4, 191, 200, 0.07);
      border: 1px solid var(--accent-soft);
      font-size: 12px;
      color: var(--text-primary);
    }

    .explanation-tagline {
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-size: 10px;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .metric-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
      font-size: 11px;
    }

    .metric-pill {
      padding: 5px 9px;
      border-radius: 999px;
      background: rgba(5, 12, 16, 0.95);
      border: 1px solid rgba(255, 255, 255, 0.06);
      color: var(--text-muted);
    }

    .metric-pill span {
      color: var(--text-primary);
      font-weight: 500;
      margin-left: 4px;
    }

    .bottom-safe {
      padding: 8px 12px 10px;
      border-top: 1px solid rgba(255, 255, 255, 0.04);
      font-size: 10px;
      color: var(--text-muted);
      background: radial-gradient(circle at top, #0b1016 0, #05080a 55%);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
    }

    .bottom-safe span {
      max-width: 80%;
    }

    .bottom-safe-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--accent);
      box-shadow: 0 0 0 4px var(--accent-soft);
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <div class="app-frame" id="app">
      <header class="top-bar">
        <div class="top-bar-left">
          <div class="brand-mark"></div>
          <div class="brand-text">
            <span>Loan assistant</span>
            <span>Secure Home Loans</span>
          </div>
        </div>
        <div class="chip-muted">Works alongside your banker</div>
      </header>

      <main class="chat-scroll" id="chatScroll">
        <div class="chat-stack" id="chatStack">
          <section class="message-card">
            <div class="message-header">
              <div class="message-header-left">
                <span class="status-dot"></span>
                <span>Thinking</span>
              </div>
              <button class="btn-ghost" type="button" disabled>Calm, private session</button>
            </div>
            <div class="message-body">
              <p><strong>Hey there.</strong> Your financial security matters to us.</p>
              <p>Tell me what you’d like to do next. You can always change any details later in the chat.</p>

              <div class="option-row" style="margin-top: 10px;">
                <button
                  type="button"
                  class="btn btn-primary"
                  id="btnStartNewLoan"
                >
                  Start a new loan check
                </button>
                <button
                  type="button"
                  class="btn btn-secondary"
                  id="btnReviewOffer"
                >
                  Review an existing offer
                </button>
              </div>
            </div>
          </section>
        </div>
      </main>

      <footer class="bottom-safe">
        <span>Answers help you reason through long‑term choices. Nothing here approves or rejects a loan.</span>
        <div class="bottom-safe-dot"></div>
      </footer>
    </div>
  </div>

  <script>
    const chatStack = document.getElementById("chatStack");
    const chatScroll = document.getElementById("chatScroll");

    const loanState = {
      amount: null,
      rate: null,
      years: 20,
      monthlyEmi: null,
      totalInterest: null,
    };

    function scrollToBottom() {
      requestAnimationFrame(() => {
        chatScroll.scrollTop = chatScroll.scrollHeight;
      });
    }

    function formatCurrency(value) {
      const n = Number(value || 0);
      if (!isFinite(n)) return "—";
      return new Intl.NumberFormat("en-IN", {
        style: "currency",
        currency: "INR",
        maximumFractionDigits: 0,
      }).format(n);
    }

    function formatPercent(value, digits = 1) {
      const n = Number(value || 0);
      if (!isFinite(n)) return "—";
      return n.toFixed(digits) + "%";
    }

    function calculateEmi(p, annualRate, years) {
      const r = annualRate / 12 / 100;
      const n = years * 12;
      if (!p || !annualRate || !years) return { emi: 0, totalInterest: 0 };
      const emi = (p * r * Math.pow(1 + r, n)) / (Math.pow(1 + r, n) - 1);
      const totalPaid = emi * n;
      const totalInterest = totalPaid - p;
      return { emi, totalInterest };
    }

    function createNewLoanCard() {
      const card = document.createElement("section");
      card.className = "message-card";
      card.innerHTML = `
        <div class="message-header">
          <div class="message-header-left">
            <span class="status-dot"></span>
            <span>Loan details</span>
          </div>
          <div class="notify-link">Autosaves while you adjust</div>
        </div>
        <div class="message-body">
          <p><strong>Let’s start with your loan details.</strong> You can tap any field to tweak numbers as we go.</p>
          <div class="input-group-card">
            <div class="input-group-title">Loan setup</div>
            <div class="field-grid">
              <label class="field">
                <div class="field-label-row">
                  <span>Loan amount</span>
                </div>
                <div class="field-input-shell">
                  <span class="field-prefix">₹</span>
                  <input
                    class="field-input"
                    type="number"
                    min="0"
                    step="100000"
                    placeholder="Enter loan amount"
                    id="loanAmountInput"
                  />
                </div>
              </label>

              <label class="field">
                <div class="field-label-row">
                  <span>Interest rate</span>
                  <span class="field-inline-value" id="interestRateValue"></span>
                </div>
                <div class="field-input-shell">
                  <input
                    class="field-input"
                    type="number"
                    min="0"
                    max="25"
                    step="0.1"
                    placeholder="Enter interest rate"
                    id="interestRateInput"
                  />
                  <span class="field-suffix">%</span>
                </div>
              </label>

              <label class="field">
                <div class="field-label-row">
                  <span>Loan tenure</span>
                  <span class="field-inline-value" id="tenureDisplay"></span>
                </div>
                <div class="field-input-shell field-input-shell--slider">
                  <input
                    type="range"
                    id="loanTenureInput"
                    min="5"
                    max="30"
                    step="1"
                  />
                </div>
              </label>
            </div>

            <div class="card-footer-row">
              <button type="button" class="btn btn-primary" id="btnCalculateLoan">
                Continue
              </button>
            </div>
          </div>
        </div>
      `;
      chatStack.appendChild(card);
      scrollToBottom();

      const loanAmountInput = card.querySelector("#loanAmountInput");
      const interestRateInput = card.querySelector("#interestRateInput");
      const interestRateValue = card.querySelector("#interestRateValue");
      const loanTenureInput = card.querySelector("#loanTenureInput");
      const tenureDisplay = card.querySelector("#tenureDisplay");
      const btnCalc = card.querySelector("#btnCalculateLoan");

      loanTenureInput.value = loanState.years;
      tenureDisplay.textContent = loanState.years + " years";

      function syncInline() {
        if (interestRateInput.value) {
          interestRateValue.textContent =
            interestRateInput.value + "% per year";
        } else {
          interestRateValue.textContent = "";
        }
      }

      interestRateInput.addEventListener("input", () => {
        syncInline();
        loanState.rate = Number(interestRateInput.value) || null;
      });

      loanAmountInput.addEventListener("input", () => {
        loanState.amount = Number(loanAmountInput.value) || null;
      });

      loanTenureInput.addEventListener("input", () => {
        loanState.years = Number(loanTenureInput.value) || 20;
        tenureDisplay.textContent = loanState.years + " years";
      });

      btnCalc.addEventListener("click", () => {
        const { amount, rate, years } = loanState;
        const { emi, totalInterest } = calculateEmi(amount, rate, years);
        loanState.monthlyEmi = emi;
        loanState.totalInterest = totalInterest;
        addLoanExplanation();
      });
    }

    function addLoanExplanation() {
      const { amount, totalInterest, monthlyEmi, years } = loanState;
      const card = document.createElement("section");
      card.className = "message-card";
      const interestToPrincipalRatio =
        amount && totalInterest ? (totalInterest / amount).toFixed(1) : null;

      card.innerHTML = `
        <div class="message-header">
          <div class="message-header-left">
            <span class="status-dot"></span>
            <span>How this loan behaves</span>
          </div>
        </div>
        <div class="message-body">
          <div class="explanation-block">
            <div class="explanation-tagline">Based on your inputs</div>
            <p>
              Over roughly <strong>${years || "—"} years</strong>, your estimated monthly EMI is
              <strong>${formatCurrency(monthlyEmi)}</strong>.
            </p>
            <p>
              Across the full tenure, you’d pay about
              <strong>${formatCurrency(totalInterest)}</strong> in interest on top of your
              principal of <strong>${formatCurrency(amount)}</strong>.
              That means interest is about
              <strong>${interestToPrincipalRatio || "—"}×</strong> your principal over time.
            </p>
            <p>
              In the early years, a large share of each EMI mainly services interest, and only a smaller part reduces the principal. As the outstanding amount falls, more of each EMI starts going toward principal.
            </p>

            <div class="metric-row">
              <div class="metric-pill">
                EMI <span>${formatCurrency(monthlyEmi)}</span> / month
              </div>
              <div class="metric-pill">
                Total interest <span>${formatCurrency(totalInterest)}</span>
              </div>
              <div class="metric-pill">
                Tenure <span>${years || "—"} years</span>
              </div>
            </div>
          </div>

          <div class="option-row">
            <button type="button" class="btn btn-secondary" data-followup="compare_value_and_life_risk">
              Compare against house value and life risk
            </button>
            <button type="button" class="btn btn-secondary" data-followup="repo_rate_impact">
              Understand what happens when the repo rate increases
            </button>
            <button type="button" class="btn btn-primary" data-followup="stress_test_emi">
              Stress-test EMI for future risks
            </button>
          </div>
        </div>
      `;
      chatStack.appendChild(card);
      scrollToBottom();

      card.querySelectorAll("[data-followup]").forEach((btn) => {
        btn.addEventListener("click", (ev) => {
          const id = ev.currentTarget.getAttribute("data-followup");
          if (id === "stress_test_emi") {
            addStressTestCard();
          } else if (id === "repo_rate_impact") {
            addRepoExplanation();
          } else if (id === "compare_value_and_life_risk") {
            addValueRiskExplanation();
          }
        });
      });
    }

    function addStressTestCard() {
      const card = document.createElement("section");
      card.className = "message-card";
      card.innerHTML = `
        <div class="message-header">
          <div class="message-header-left">
            <span class="status-dot"></span>
            <span>Stress-test EMI</span>
          </div>
          <div class="notify-link">Updates as you slide</div>
        </div>
        <div class="message-body">
          <p><strong>Let’s see how your EMI behaves if things change.</strong> We’ll keep all your earlier loan details in mind while you adjust income.</p>

          <div class="input-group-card">
            <div class="input-group-title">Income scenarios</div>
            <div class="field-grid">
              <label class="field">
                <div class="field-label-row">
                  <span>Monthly income</span>
                </div>
                <div class="field-input-shell">
                  <span class="field-prefix">₹</span>
                  <input
                    class="field-input"
                    type="number"
                    min="0"
                    step="5000"
                    placeholder="Enter monthly income"
                    id="monthlyIncomeInput"
                  />
                </div>
              </label>

              <label class="field">
                <div class="field-label-row">
                  <span>Possible income change</span>
                  <span class="field-inline-value" id="incomeDropDisplay"></span>
                </div>
                <div class="field-input-shell field-input-shell--slider">
                  <input
                    type="range"
                    id="incomeDropSlider"
                    min="-30"
                    max="0"
                    step="5"
                  />
                </div>
                <div class="field-helper">
                  Simulate a potential drop in income and see how much space your EMI still leaves for other needs.
                </div>
              </label>
            </div>
          </div>

          <div class="explanation-block" id="stressExplanation">
            <div class="explanation-tagline">When income changes</div>
            <p>
              Once you add your income and adjust the slider, I’ll show you how much of your monthly earnings the EMI may occupy in that scenario.
            </p>
          </div>
        </div>
      `;
      chatStack.appendChild(card);
      scrollToBottom();

      const incomeInput = card.querySelector("#monthlyIncomeInput");
      const slider = card.querySelector("#incomeDropSlider");
      const display = card.querySelector("#incomeDropDisplay");
      const explanation = card.querySelector("#stressExplanation");

      slider.value = 0;
      display.textContent = "0% change";

      function updateExplanation() {
        const baseIncome = Number(incomeInput.value);
        const dropPercent = Number(slider.value);
        const emi = loanState.monthlyEmi || 0;

        display.textContent = `${dropPercent}% change`;

        if (!baseIncome || !emi) {
          explanation.innerHTML = `
            <div class="explanation-tagline">When income changes</div>
            <p>
              Add your monthly income so we can see what share of it might go toward your EMI under different conditions.
            </p>
          `;
          return;
        }

        const effectiveIncome = baseIncome * (1 + dropPercent / 100);
        const share = effectiveIncome ? (emi / effectiveIncome) * 100 : 0;
        const roundedShare = share.toFixed(1);

        let tone;
        if (share < 25) {
          tone =
            "Your EMI remains a modest part of your income, leaving room for regular expenses and some savings.";
        } else if (share < 40) {
          tone =
            "Your EMI takes a noticeable share of income, so you may feel tighter months if other big costs show up together.";
        } else {
          tone =
            "Your EMI would occupy a large part of your income in this scenario, leaving less buffer for essentials and emergencies.";
        }

        explanation.innerHTML = `
          <div class="explanation-tagline">In this scenario</div>
          <p>
            With income at <strong>${formatCurrency(
              effectiveIncome
            )}</strong> after a ${formatPercent(
          dropPercent,
          0
        )} change, your EMI of <strong>${formatCurrency(
          emi
        )}</strong> would use about <strong>${formatPercent(
          roundedShare,
          1
        )}</strong> of your monthly earnings.
          </p>
          <p>${tone}</p>
        `;
      }

      incomeInput.addEventListener("input", updateExplanation);
      slider.addEventListener("input", updateExplanation);
    }

    function addRepoExplanation() {
      const card = document.createElement("section");
      card.className = "message-card";
      card.innerHTML = `
        <div class="message-header">
          <div class="message-header-left">
            <span class="status-dot"></span>
            <span>Repo rate changes</span>
          </div>
        </div>
        <div class="message-body">
          <div class="explanation-block">
            <div class="explanation-tagline">How rate hikes flow to you</div>
            <p>
              When the repo rate rises, banks typically increase their lending rates. For a floating‑rate home loan, that can show up as a higher EMI, a longer tenure, or a mix of both.
            </p>
            <p>
              Even a small increase in the interest rate can add up over a long tenure. The effect is usually more visible in the early years when most of your EMI is still going toward interest rather than principal.
            </p>
            <p>
              If you’d like, you can slightly increase the rate in your loan details and see how your EMI and total interest change side by side.
            </p>
          </div>
        </div>
      `;
      chatStack.appendChild(card);
      scrollToBottom();
    }

    function addValueRiskExplanation() {
      const card = document.createElement("section");
      card.className = "message-card";
      card.innerHTML = `
        <div class="message-header">
          <div class="message-header-left">
            <span class="status-dot"></span>
            <span>Home value and life events</span>
          </div>
        </div>
        <div class="message-body">
          <div class="explanation-block">
            <div class="explanation-tagline">Looking beyond the EMI</div>
            <p>
              A home loan isn’t only about the interest you pay. It also links to how the property value may move over time and how stable your income and family needs are.
            </p>
            <p>
              Many people find it useful to think in two layers: first, whether the EMI is comfortable in normal months, and second, how they would handle big life events such as job changes, health situations, or children’s education while the loan is running.
            </p>
            <p>
              You can keep adjusting your loan amount or tenure here to see how much room you want to leave in your monthly budget for those possibilities.
            </p>
          </div>
        </div>
      `;
      chatStack.appendChild(card);
      scrollToBottom();
    }

    document
      .getElementById("btnStartNewLoan")
      .addEventListener("click", () => {
        createNewLoanCard();
      });

    document
      .getElementById("btnReviewOffer")
      .addEventListener("click", () => {
        const card = document.createElement("section");
        card.className = "message-card";
        card.innerHTML = `
          <div class="message-header">
            <div class="message-header-left">
              <span class="status-dot"></span>
              <span>Review an existing offer</span>
            </div>
          </div>
          <div class="message-body">
            <p>
              You can paste the main details from your existing loan offer here — loan amount, rate, tenure, and any special conditions — and we’ll walk through how it behaves over time.
            </p>
            <p>
              For now this space is for explanation only. It doesn’t accept documents and doesn’t change your official application in any way.
            </p>
          </div>
        `;
        chatStack.appendChild(card);
        scrollToBottom();
      });
  </script>
</body>
</html>
